<html ng-app='notes'>
<head>
	<meta charset='utf-8'>		
	
	<link rel='stylesheet' type='text/css' 	href='http://localhost:8000/static/notes.css'></link>
	<script type='text/javascript' 			src='http://localhost:8000/static/notes.js'></script>	
	<script type='text/javascript' 			src='http://localhost:8000/static/js_input.js'></script>
	
	<script type='text/javascript' 			src='http://localhost:8000/static/jquery2.2.3.min.js'></script>
	<script type='text/javascript' 			src='http://localhost:8000/static/angular1.4.5.min.js'></script>
	
	<!--
	<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular-route.min.js"></script>
	<script type='text/javascript' src='https://code.jquery.com/jquery-2.1.3.js'></script>
	-->
	<title>notes</title>
	
	<script>
		function print(msg){$('#msgbox').append(msg+'<br>');}	//print function
		//-------
		$(document).ready(function(){
			send_ajax({'py_msg':'get_data'});
		});
		//-------
		function append_db_data(data){
			var entry_num=0;
			for (i=0;i<data.length;i++){
				var new_entry = "<div class='data_list_entry border'>"+
									"<div class='notes data_column border entry"	+String(entry_num)+"'>"+data[i][1]+"</div>"+
									"<div class='titles data_column border entry"	+String(entry_num)+"'>"+data[i][2]+"</div>"+
									"<div class='urls data_column border entry"		+String(entry_num)+"'>"+data[i][3]+"</div>"+
								"</div>";
				entry_num++;
				$('#data_list').append(new_entry);
			}	
		}
			
		//--------
		$(document).on('click','.data_column',function(){
			$('.data_column').css({'background-color':'white'});
			var el = $(this).attr('class').split(' ');
			for (i=0;i<el.length;i++){
				if (el[i].substring(0,5) == 'entry'){
					el = el[i];
					break;
				}
			}
			print(el);
			$('.'+el).css({'background-color':'yellow'});
		});
		//--------
		function send_ajax(params){
			$.ajax({
				method:'post',
				url:'/cgi-bin/notes.py',
				data:{'package':JSON.stringify(params)},
				success:function(result){
					if (params.py_msg == 'add_url'){		//result is confirmation message (string)
						print(result);
					}
					else if (params.py_msg == 'get_data'){	//result is database json object
						append_db_data(JSON.parse(result));
					}
				}
			});
		}
		//-------
		$(document).on('click','#add_url',function(){
			var url = $('#url').val();
			var note = $('#note').val();
			var folder = $('.folder').filter(function(){
				return $(this).hasClass('folder_highlight');
			}).html();
			
			if (note == ''){	//if no note, prompt for note
				var dict = {
					input_msg	:'enter a note?',
					el			:'',
					callback	:send_ajax,				
					params		:		
						{
							py_msg	:'add_url',
							url		:url,
							folder	:folder
						}
				}
				js_input(dict);
			}
			else{
				send_ajax({'py_msg':'add_url','url':url,'user_input':note,'folder':folder});
			}			
		});
		//--------
		var notes = angular.module('notes',[]);
		notes.controller('main',['$scope',function($scope){
			$scope.greeting ='yes';
		}]);
		//---------
		$(document).on('click','.folder',function(){
			$('.folder').removeClass('folder_highlight');
			$(this).addClass('folder_highlight');
		});
	</script>
</head>
<body ng-controller='main'>
	<div id='container'>
		<h3>notes</h3>
		<!--_____________left pane_________________-->
		<div id='left_pane' class='panes border'>
			url			<!--url-->
				<br>
			<textarea id='url'>http://imgur.com/random</textarea>
				<br>
			<button id='add_url'>add url</button>
				<br>
				<br>
			note		<!--note-->
				<br>
			<textarea id='note'>asdf</textarea>
				<br>
		
			folders		<!--folders-->
			<div id='folder_list' class='border'>
				<div class='folder folder_highlight'>all</div>
				<div class='folder'>default</div>
			</div>
		</div>
		
		<!--_____________right pane_________________-->
		<div id='right_pane' class='panes border'>
			data
				<br>
			<div id='data_list' class='border'>
				<div id='data_list_header_cols' class='border'>
				
					<div class='data_list_header_col border'>note</div>
					<div class='data_list_header_col border'>title</div>
					<div class='data_list_header_col border'>url</div>
				</div>	
				<!--
				<div class='data_list_entry border'>
					<div class='notes data_column border'>this is a note</div>
					<div class='titles data_column border'>this is a title</div>
					<div class='urls data_column border'>this is a url</div>
				</div>
				-->
				
			</div>
		</div>
		
	</div>
		
	<div id='msgbox'></div>
	
	<style>
	
	</style>
</body>
</html>